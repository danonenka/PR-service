# PR Service - Сервис назначения ревьюеров для Pull Request'ов

Микросервис для автоматического назначения ревьюеров на Pull Request'ы с управлением командами и участниками.

### Структура проекта

```
pr-service-task/
├── cmd/
│   └── server/          # Точка входа приложения
├── internal/
│   ├── domain/          # Доменные модели и интерфейсы репозиториев
│   ├── usecase/         # Бизнес-логика (use cases)
│   ├── repository/      # Реализация репозиториев (PostgreSQL)
│   └── delivery/        # HTTP handlers и роутинг
├── migrations/          # Миграции базы данных
├── docker-compose.yml   # Конфигурация Docker Compose
├── Dockerfile           # Docker образ приложения
├── Makefile             # Команды для сборки и запуска
└── README.md            # Документация
```

### Слои архитектуры

1. **Domain** - содержит бизнес-сущности (User, Team, PullRequest) и интерфейсы репозиториев
2. **Usecase** - содержит бизнес-логику приложения
3. **Repository** - реализация работы с базой данных
4. **Delivery** - HTTP handlers и роутинг


### Запуск через Docker Compose

```bash
docker-compose up
```

## Особенности реализации

### Чистая архитектура

- **Domain слой** не зависит от внешних библиотек
- **Usecase слой** зависит только от domain интерфейсов
- **Repository слой** реализует domain интерфейсы
- **Delivery слой** зависит только от usecase

### Назначение ревьюеров

- При создании PR автоматически назначаются до 2 активных ревьюеров из команды автора
- Автор исключается из списка кандидатов
- Если доступных кандидатов меньше двух, назначается доступное количество (0/1)
- Ревьюеры выбираются случайным образом

### Переназначение ревьюеров

- Переназначение возможно только для открытых PR
- После merge изменение ревьюеров запрещено
- Новый ревьюер выбирается из команды заменяемого ревьюера
- Исключаются автор PR и текущие ревьюеры

### Безопасное переназначение при деактивации

- При массовой деактивации пользователей автоматически переназначаются ревьюеры для всех открытых PR
- Новые ревьюеры выбираются из команды автора PR
- Если нет доступных кандидатов, деактивированный ревьюер просто удаляется

### Идемпотентность merge

- Операция merge идемпотентна - повторный вызов не приводит к ошибке
- Возвращается актуальное состояние PR